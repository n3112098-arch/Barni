
from .. import loader, utils
import requests
from telethon.tl.types import MessageMediaPhoto

class PhotoMagic(loader.Module):
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è AI-—Ñ–æ—Ç–æ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é"""
    strings = {"name": "PhotoMagic"}

    async def generate(self, message):
        """–°–æ–∑–¥–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: .generate –æ–ø–∏—Å–∞–Ω–∏–µ"""
        prompt = utils.get_args_raw(message)
        if not prompt:
            return await message.edit("üîÆ –ù–∞–ø–∏—à–∏ –æ–ø–∏—Å–∞–Ω–∏–µ: `.generate –∫—Ä–∞—Å–∏–≤–∞—è –¥–µ–≤—É—à–∫–∞ —É –º–æ—Ä—è`")

        await message.edit("üé® –ì–µ–Ω–µ—Ä–∏—Ä—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ...")

        # URL Pollinations (–±–µ–∑ API –∫–ª—é—á–∞)
        url = f"https://image.pollinations.ai/prompt/{prompt.replace(' ', '%20')}"

        try:
            image = requests.get(url, timeout=30).content
        except Exception:
            return await message.edit("‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ Pollinations.")

        # —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ —Ñ–∞–π–ª
        file = "generated.png"
        with open(file, "wb") as f:
            f.write(image)

        # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ
        await message.client.send_file(
            message.chat_id,
            file,
            caption=f"‚ú® PhotoMagic\nüìù –û–ø–∏—Å–∞–Ω–∏–µ: {prompt}"
        )

        await message.delete()