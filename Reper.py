from .. import loader, utils
import random
import asyncio

class AdvancedRapMod(loader.Module):
    """–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ—Ä–æ—Ç–∫–æ–≥–æ —Ä—ç–ø–∞"""

    @loader.command()
    async def rap(self, message):
        """.rap <—Ç–µ–º–∞> ‚Äî –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–π —Ä—ç–ø —Å —Ä–∏—Ñ–º–æ–π –∏ –±–∏—Ç–æ–º"""
        args = utils.get_args_raw(message)
        if not args:
            return await message.edit("‚ùå –£–∫–∞–∂–∏ —Ç–µ–º—É, –Ω–∞–ø—Ä–∏–º–µ—Ä: `.rap –ª—é–±–æ–≤—å`")

        theme = args.lower()

        # —Å–ª–æ–≤–∞—Ä—å —Å–ª–æ–≤ –ø–æ —Ç–µ–º–∞–º
        words = {
            "–ª—é–±–æ–≤—å": ["—Å–µ—Ä–¥—Ü–µ", "–æ–≥–æ–Ω—å", "–º–µ—á—Ç–∞", "—Ç–µ–Ω—å", "–¥—É—à–∞", "–Ω–µ–∂–Ω–æ", "–∑–≤–µ–∑–¥–∞", "—Å–≤–µ—Ç", "–ø—É—Ç—å", "–ª—é–±–æ–≤—å"],
            "–¥—Ä—É–∂–±–∞": ["–¥—Ä—É–≥", "—Å–º–µ—Ö", "—Ä—É–∫–∞", "–≤–º–µ—Å—Ç–µ", "—Å–∏–ª–∞", "—Ä–∞–¥–æ—Å—Ç—å", "–ø—É—Ç—å", "–∫–æ–º–∞–Ω–¥–∞", "–ø–æ–¥–¥–µ—Ä–∂–∫–∞", "–≤–µ—Ä–Ω–æ—Å—Ç—å"],
            "–∂–∏–∑–Ω—å": ["–¥–æ—Ä–æ–≥–∞", "—à—Ç–æ—Ä–º", "–±–∏—Ç", "—Ä–∏—Ç–º", "–ø—É—Ç—å", "—Å–≤–µ—Ç", "—Ç–µ–Ω–∏", "–¥–µ–Ω—å", "–Ω–æ—á—å", "–≤—Ä–µ–º—è"],
            "–¥–µ–Ω—å–≥–∏": ["–∫–∞—Ä–º–∞–Ω", "–±–æ–≥–∞—Ç—Å—Ç–≤–æ", "–¥–æ—Ö–æ–¥", "–º–µ—á—Ç–∞", "—Ü–µ–ª—å", "—Å–∏–ª–∞", "—É—Å–ø–µ—Ö", "–±–æ–Ω—É—Å", "—Ä–æ—Å—Ç", "–ø—Ä–∏–±—ã–ª—å"]
        }

        # —ç–º–æ–¥–∑–∏ –¥–ª—è —É–∫—Ä–∞—à–µ–Ω–∏—è
        emojis = ["üíñ","üî•","üí™","üéµ","‚ú®","‚ö°","üíé","üåü","üí•","üí´"]

        # –≤—ã–±–∏—Ä–∞–µ–º —Å–ª–æ–≤–∞ –¥–ª—è —Ä–∏—Ñ–º—ã
        if theme in words:
            pool = words[theme]
        else:
            pool = random.choice(list(words.values()))

        # –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º 4 —Å—Ç—Ä–æ–∫–∏ —Ä—ç–ø–∞
        rap_lines = []
        for _ in range(4):
            line_len = random.randint(4,6)  # —Å–ª–æ–≤ –≤ —Å—Ç—Ä–æ–∫–µ
            line_words = random.choices(pool, k=line_len)
            # —Å–ª—É—á–∞–π–Ω—ã–µ —ç–º–æ–¥–∑–∏ –ø–æ—Å–ª–µ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª–æ–≤
            line = " ".join([w + random.choice(emojis) if random.random()<0.4 else w for w in line_words])
            rap_lines.append(line)

        # –¥–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à–æ–π —Ä–∏—Ç–º/—Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ –¥–ª—è ‚Äú–±–∏—Ç–æ–≤‚Äù
        rap_text = "\n".join([f"{line} üéµ" for line in rap_lines])

        await message.edit(f"üé§ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —Ä—ç–ø –Ω–∞ —Ç–µ–º—É '{theme}':\n\n{rap_text}")